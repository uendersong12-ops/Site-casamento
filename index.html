<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Lista de Presentes</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Lora&display=swap" rel="stylesheet">

  <!-- Seu CSS local -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="noivos">Uenderson &amp; Jéssica</div>

    <!-- Carrossel -->
    <div class="swiper mySwiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide"><img src="imagens/1.jpg" alt="1"></div>
        <div class="swiper-slide"><img src="imagens/5.jpg" alt="5"></div>
        <div class="swiper-slide"><img src="imagens/21.jpg" alt="21"></div>
        <div class="swiper-slide"><img src="imagens/24.jpg" alt="24"></div>
        <div class="swiper-slide"><img src="imagens/70.jpg" alt="70"></div>
        <div class="swiper-slide"><img src="imagens/80.jpg" alt="80"></div>
        <div class="swiper-slide"><img src="imagens/82.jpg" alt="82"></div>
        <div class="swiper-slide"><img src="imagens/88.jpg" alt="88"></div>
        <div class="swiper-slide"><img src="imagens/147.jpg" alt="147"></div>
        <div class="swiper-slide"><img src="imagens/156.jpg" alt="156"></div>
      </div>
      <!-- navegação -->
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
      <!-- paginação -->
      <div class="swiper-pagination"></div>
    </div>

    <div class="mensagem">
      Bem-vindo(a) à nossa Lista de Presentes! Desde já queremos agradecer, de coração, a cada um de vocês por fazer parte deste momento tão especial em nossas vidas. Para quem deseja nos presentear, criamos esta lista com muito carinho. Você pode escolher um dos itens sugeridos abaixo ou, se preferir, contribuir com qualquer valor. É importante lembrar que sua presença no nosso casamento é o maior presente que poderíamos receber e que não há qualquer obrigação de trazer um presente para participar. Muito obrigado por todo o carinho e apoio! 
    </div>

    <!-- Tabela -->
    <div class="table-wrap">
      <table aria-label="Tabela de presentes">
        <thead>
          <tr>
            <th>Imagem</th>
            <th>Item</th>
            <th>Valor</th>
            <th>Status</th>
            <th>Ação</th>
          </tr>
        </thead>
        <tbody id="tabela-presentes"></tbody>
      </table>
    </div>
  </div>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <!-- Inicializa o Swiper -->
  <script>
    const swiper = new Swiper('.mySwiper', {
      loop: true,
      autoplay: { delay: 4000, disableOnInteraction: false },
      pagination: { el: '.swiper-pagination', clickable: true },
      navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
    });
  </script>

  <!-- Script da lista -->
  <script>
    const API_URL = "https://site-casamento-backend.onrender.com";
    const IMG_PREFIX = "imagens/";

    let presentes = [];

    async function carregarPresentes() {
      try {
        const res = await fetch(`${API_URL}/presentes`);
        presentes = await res.json();
        carregarTabela();
      } catch (err) {
        console.error("Erro ao carregar presentes:", err);
        alert("Não foi possível carregar a lista de presentes.");
      }
    }

    function carregarTabela() {
      const tabela = document.getElementById("tabela-presentes");
      tabela.innerHTML = "";

      presentes.forEach(item => {
        const tr = document.createElement("tr");

        // imagem
        const tdImagem = document.createElement("td");
        const img = document.createElement("img");
        img.src = IMG_PREFIX + (item.imagem || "placeholder.jpg");
        img.alt = item.nome;
        tdImagem.appendChild(img);

        // nome
        const tdNome = document.createElement("td");
        tdNome.textContent = item.nome;

        // valor
        const tdValor = document.createElement("td");
        tdValor.textContent = item.valor ?? "—";

        // status
        const tdStatus = document.createElement("td");
        tdStatus.textContent = item.assinaturasrestantes > 0 ? "Disponível" : "Esgotado ✅";

        // ação
        const tdAcao = document.createElement("td");
        if (item.assinaturasrestantes > 0) {
          const botao = document.createElement("button");
          botao.className = "btn-reservar";
          botao.textContent = "Reservar";
          botao.onclick = () => reservarPresente(item.id);
          tdAcao.appendChild(botao);
        } else {
          tdAcao.textContent = "—";
        }

        tr.appendChild(tdImagem);
        tr.appendChild(tdNome);
        tr.appendChild(tdValor);
        tr.appendChild(tdStatus);
        tr.appendChild(tdAcao);

        tabela.appendChild(tr);
      });
    }

    async function reservarPresente(id) {
      const nome = prompt("Digite seu nome para reservar este presente:");
      if (!nome || !nome.trim()) return;

      try {
        const res = await fetch(`${API_URL}/assinar`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id })
        });

        if (!res.ok) {
          const erro = await res.text();
          alert("Erro: " + erro);
          return;
        }

        await carregarPresentes();
      } catch (err) {
        console.error("Erro ao assinar presente:", err);
      }
    }

    document.addEventListener("DOMContentLoaded", carregarPresentes);
  </script>
</body>
</html>

